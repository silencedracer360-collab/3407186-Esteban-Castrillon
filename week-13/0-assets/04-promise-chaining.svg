<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 1000">
  <!-- Dark Background -->
  <rect width="1200" height="1000" fill="#0f172a"/>

  <!-- Title -->
  <text x="600" y="50" font-family="system-ui, -apple-system, sans-serif" font-size="32" font-weight="700" fill="#f0db4f" text-anchor="middle">
    Promise Chaining
  </text>

  <!-- Chain Visualization -->
  <g id="chain">
    <!-- Step 1 -->
    <g id="step1">
      <rect x="100" y="120" width="250" height="120" fill="#1e293b" stroke="#3b82f6" stroke-width="3" rx="10"/>
      <text x="225" y="155" font-family="system-ui" font-size="18" font-weight="600" fill="#3b82f6" text-anchor="middle">
        Paso 1: fetch()
      </text>
      <rect x="120" y="170" width="210" height="50" fill="#0f172a" rx="5"/>
      <text x="225" y="193" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle">
        fetch('/api/user/1')
      </text>
      <text x="225" y="213" font-family="monospace" font-size="12" fill="#22c55e" text-anchor="middle">
        → retorna Response
      </text>
    </g>

    <!-- Arrow 1 -->
    <defs>
      <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <polygon points="0 0, 10 3, 0 6" fill="#3b82f6"/>
      </marker>
    </defs>
    <path d="M 225 240 L 225 280" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-blue)"/>
    <text x="250" y="265" font-family="system-ui" font-size="12" fill="#94a3b8">
      .then()
    </text>

    <!-- Step 2 -->
    <g id="step2">
      <rect x="100" y="280" width="250" height="120" fill="#1e293b" stroke="#3b82f6" stroke-width="3" rx="10"/>
      <text x="225" y="315" font-family="system-ui" font-size="18" font-weight="600" fill="#3b82f6" text-anchor="middle">
        Paso 2: Parsear JSON
      </text>
      <rect x="120" y="330" width="210" height="50" fill="#0f172a" rx="5"/>
      <text x="225" y="353" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle">
        response.json()
      </text>
      <text x="225" y="373" font-family="monospace" font-size="12" fill="#22c55e" text-anchor="middle">
        → retorna Object
      </text>
    </g>

    <!-- Arrow 2 -->
    <path d="M 225 400 L 225 440" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-blue)"/>
    <text x="250" y="425" font-family="system-ui" font-size="12" fill="#94a3b8">
      .then()
    </text>

    <!-- Step 3 -->
    <g id="step3">
      <rect x="100" y="440" width="250" height="120" fill="#1e293b" stroke="#3b82f6" stroke-width="3" rx="10"/>
      <text x="225" y="475" font-family="system-ui" font-size="18" font-weight="600" fill="#3b82f6" text-anchor="middle">
        Paso 3: Procesar Datos
      </text>
      <rect x="120" y="490" width="210" height="50" fill="#0f172a" rx="5"/>
      <text x="225" y="513" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle">
        user => user.name
      </text>
      <text x="225" y="533" font-family="monospace" font-size="12" fill="#22c55e" text-anchor="middle">
        → retorna String
      </text>
    </g>

    <!-- Arrow 3 -->
    <path d="M 225 560 L 225 600" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-blue)"/>
    <text x="250" y="585" font-family="system-ui" font-size="12" fill="#94a3b8">
      .then()
    </text>

    <!-- Step 4 -->
    <g id="step4">
      <rect x="100" y="600" width="250" height="100" fill="#1e293b" stroke="#22c55e" stroke-width="3" rx="10"/>
      <text x="225" y="635" font-family="system-ui" font-size="18" font-weight="600" fill="#22c55e" text-anchor="middle">
        Resultado Final
      </text>
      <rect x="120" y="650" width="210" height="35" fill="#0f172a" rx="5"/>
      <text x="225" y="673" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle">
        name => console.log(name)
      </text>
    </g>

    <!-- Error Handler -->
    <g id="error">
      <rect x="100" y="730" width="250" height="80" fill="#1e293b" stroke="#ef4444" stroke-width="3" rx="10"/>
      <text x="225" y="765" font-family="system-ui" font-size="18" font-weight="600" fill="#ef4444" text-anchor="middle">
        Manejador de Errores
      </text>
      <rect x="120" y="775" width="210" height="25" fill="#0f172a" rx="5"/>
      <text x="225" y="793" font-family="monospace" font-size="12" fill="#f1f5f9" text-anchor="middle">
        .catch(err => console.error(err))
      </text>
    </g>

    <!-- Error arrow -->
    <defs>
      <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <polygon points="0 0, 10 3, 0 6" fill="#ef4444"/>
      </marker>
    </defs>
    <path d="M 100 380 L 50 380 L 50 770 L 100 770" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrow-red)" stroke-dasharray="5,5"/>
    <text x="25" y="575" font-family="system-ui" font-size="11" fill="#ef4444" writing-mode="tb">
      Cualquier error salta aquí
    </text>
  </g>

  <!-- Code Example -->
  <g id="code">
    <rect x="450" y="120" width="700" height="490" fill="#1e293b" stroke="#f0db4f" stroke-width="3" rx="10"/>
    <text x="800" y="160" font-family="system-ui" font-size="20" font-weight="600" fill="#f0db4f" text-anchor="middle">
      Ejemplo Completo
    </text>

    <g font-family="monospace" font-size="14" fill="#f1f5f9">
      <text x="470" y="200">fetch('/api/user/1')</text>

      <text x="480" y="235">.then(response => {</text>
      <text x="490" y="260" fill="#94a3b8">  // Paso 1: Obtuvimos objeto Response</text>
      <text x="490" y="285">  console.log('Status:', response.status);</text>
      <text x="490" y="310">  </text>
      <text x="490" y="335">  if (!response.ok) {</text>
      <text x="500" y="360">    throw new Error('HTTP error');</text>
      <text x="490" y="385">  }</text>
      <text x="490" y="410">  </text>
      <text x="490" y="435" fill="#22c55e">  return response.json(); // Retorna nueva Promise</text>
      <text x="480" y="460">})</text>

      <text x="480" y="495">.then(user =&gt; {</text>
      <text x="490" y="520" fill="#94a3b8">  // Paso 2: Obtuvimos objeto user parseado</text>
      <text x="490" y="545">  console.log('User ID:', user.id);</text>
      <text x="490" y="570" fill="#22c55e">  return user.name; // Retorna valor (envuelto en Promise)</text>
      <text x="480" y="595">})</text>
    </g>
  </g>

  <!-- Rules -->
  <g id="rules">
    <rect x="450" y="650" width="340" height="280" fill="#1e293b" stroke="#f59e0b" stroke-width="2" rx="5"/>
    <text x="620" y="685" font-family="system-ui" font-size="18" font-weight="600" fill="#f59e0b" text-anchor="middle">
      ⚡ Reglas de Encadenamiento
    </text>

    <g transform="translate(470, 705)">
      <circle cx="0" cy="-5" r="4" fill="#f0db4f"/>
      <text x="12" y="0" font-family="system-ui" font-size="13" fill="#f1f5f9">
        1. .then() siempre retorna una Promise
      </text>

      <circle cx="0" cy="25" r="4" fill="#f0db4f"/>
      <text x="12" y="30" font-family="system-ui" font-size="13" fill="#f1f5f9">
        2. El valor retornado se envuelve en Promise
      </text>

      <circle cx="0" cy="55" r="4" fill="#f0db4f"/>
      <text x="12" y="60" font-family="system-ui" font-size="13" fill="#f1f5f9">
        3. Si retornas una Promise, se usa esa
      </text>

      <circle cx="0" cy="85" r="4" fill="#f0db4f"/>
      <text x="12" y="90" font-family="system-ui" font-size="13" fill="#f1f5f9">
        4. Sin return = undefined (aún envuelto)
      </text>

      <circle cx="0" cy="115" r="4" fill="#f0db4f"/>
      <text x="12" y="120" font-family="system-ui" font-size="13" fill="#f1f5f9">
        5. .catch() maneja cualquier error en la cadena
      </text>

      <circle cx="0" cy="145" r="4" fill="#f0db4f"/>
      <text x="12" y="150" font-family="system-ui" font-size="13" fill="#f1f5f9">
        6. Puedes seguir encadenando después de .catch()
      </text>

      <circle cx="0" cy="175" r="4" fill="#f0db4f"/>
      <text x="12" y="180" font-family="system-ui" font-size="13" fill="#f1f5f9">
        7. .finally() se ejecuta sin importar qué
      </text>

      <circle cx="0" cy="205" r="4" fill="#f0db4f"/>
      <text x="12" y="210" font-family="system-ui" font-size="13" fill="#f1f5f9">
        8. Mantén cadenas planas, evita anidar
      </text>
    </g>
  </g>

  <!-- Common Mistake -->
  <g id="mistake">
    <rect x="810" y="650" width="340" height="280" fill="#1e293b" stroke="#ef4444" stroke-width="2" rx="5"/>
    <text x="980" y="685" font-family="system-ui" font-size="18" font-weight="600" fill="#ef4444" text-anchor="middle">
      ❌ Error Común
    </text>

    <g font-family="monospace" font-size="12" fill="#f1f5f9">
      <text x="830" y="715">fetch('/api/user')</text>
      <text x="840" y="740">.then(response => {</text>
      <text x="850" y="765" fill="#ef4444">  response.json().then(user => {</text>
      <text x="860" y="790" fill="#ef4444">    // ❌ ¡Promise anidada!</text>
      <text x="860" y="815" fill="#ef4444">    // Esto rompe la cadena</text>
      <text x="850" y="840" fill="#ef4444">  });</text>
      <text x="850" y="865" fill="#94a3b8">  // ¡Falta el return!</text>
      <text x="840" y="890">});</text>
    </g>
  </g>
</svg>
